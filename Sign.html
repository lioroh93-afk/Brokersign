<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BrokerSign â€“ ×—×ª×™××” ×¢×œ ××¡××š</title>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{--ink:#0f0e0d;--paper:#f7f4ef;--warm:#faf8f4;--gold:#c9a84c;--deep:#1a1714;--mid:#6b6560;--border:#ddd8cf;--success:#2d6a4f}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Heebo',sans-serif;background:var(--paper);color:var(--ink);direction:rtl;min-height:100vh}
.header{background:var(--deep);padding:16px 24px;display:flex;align-items:center;justify-content:space-between}
.header .brand{font-family:'Playfair Display',serif;font-size:20px;color:var(--gold)}
.header .secure{font-size:12px;color:rgba(255,255,255,0.5)}
.container{max-width:720px;margin:0 auto;padding:28px 20px}
.card{background:var(--warm);border:1px solid var(--border);border-radius:16px;padding:28px;margin-bottom:20px}
.contract{font-size:14px;line-height:2;color:#1a1a1a}
.contract-title{text-align:center;font-size:20px;font-weight:900;margin-bottom:6px;letter-spacing:1px}
.contract-sub{text-align:center;font-size:13px;color:var(--mid);margin-bottom:24px;padding-bottom:20px;border-bottom:2px solid var(--ink)}
.contract-section{margin-bottom:20px}
.contract-section-title{font-size:15px;font-weight:800;margin-bottom:10px;color:var(--deep);border-right:3px solid var(--gold);padding-right:10px}
.contract-parties{background:#fff;border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:12px}
.party-row{display:grid;grid-template-columns:130px 1fr;gap:8px;padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.06);font-size:13px}
.party-row:last-child{border-bottom:none}
.party-label{color:var(--mid);font-weight:600}
.party-value{font-weight:700}
.contract-clause{margin-bottom:14px;padding-right:20px;position:relative;line-height:1.9;font-size:13.5px}
.contract-clause::before{content:counter(clause-counter);counter-increment:clause-counter;position:absolute;right:0;font-weight:800;color:var(--gold);font-size:12px;top:4px}
.contract-body{counter-reset:clause-counter}
.contract-highlight{background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.3);border-radius:6px;padding:10px 14px;margin:12px 0;font-weight:600;font-size:13px}
.contract-footer{margin-top:24px;padding-top:20px;border-top:2px solid var(--ink);text-align:center;font-size:12px;color:var(--mid)}
.fee-edit-box{background:#fff;border:2px solid var(--gold);border-radius:10px;padding:16px;margin-top:20px}
.fee-edit-box label{display:block;font-size:13px;font-weight:700;margin-bottom:8px;color:var(--deep)}
.fee-edit-box input{width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;font-family:'Heebo',sans-serif;font-size:15px;font-weight:700;text-align:center}
.fee-edit-box input:focus{outline:none;border-color:var(--gold)}
.fee-edit-note{font-size:11px;color:var(--mid);margin-top:6px;text-align:center}
.sig-label{font-size:13px;font-weight:600;margin-bottom:8px;display:block}
.sig-area{border:2px dashed var(--border);border-radius:10px;background:#fff;height:160px;position:relative;overflow:hidden;cursor:crosshair;margin-bottom:10px;touch-action:none}
.sig-area canvas{position:absolute;inset:0}
.sig-placeholder{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--mid);font-size:14px;pointer-events:none}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:13px;font-weight:600;margin-bottom:6px}
.form-input{width:100%;padding:11px 14px;border:1.5px solid var(--border);border-radius:8px;font-family:'Heebo',sans-serif;font-size:14px;background:#fff;direction:rtl}
.form-input:focus{outline:none;border-color:var(--gold)}
.checkbox-wrap{display:flex;gap:10px;align-items:flex-start;margin-bottom:20px}
.checkbox-wrap input{width:18px;height:18px;margin-top:2px;flex-shrink:0}
.checkbox-wrap label{font-size:13px;line-height:1.6;color:var(--mid)}
.btn{width:100%;padding:14px;border-radius:10px;font-family:'Heebo',sans-serif;font-size:16px;font-weight:700;cursor:pointer;border:none;transition:all 0.2s}
.btn-primary{background:var(--gold);color:var(--deep)}
.btn-primary:disabled{background:var(--border);color:var(--mid);cursor:not-allowed}
.btn-ghost{background:transparent;color:var(--mid);font-size:13px;margin-top:10px}
.success-screen{text-align:center;padding:60px 20px}
.success-screen .check{font-size:72px;margin-bottom:20px}
.success-screen h2{font-size:24px;font-weight:800;margin-bottom:10px}
.success-screen p{color:var(--mid);font-size:15px;line-height:1.7}
.success-details{background:rgba(45,106,79,0.08);border:1px solid rgba(45,106,79,0.2);border-radius:10px;padding:16px;margin:20px 0;text-align:right;font-size:13px}
.success-details strong{display:block;margin-bottom:8px;color:var(--success);font-size:14px}
.error-screen,.loading-screen{text-align:center;padding:80px 20px}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}
.step{display:none}
.step.active{display:block}
.download-btn{display:inline-flex;align-items:center;gap:8px;background:var(--deep);color:#fff;padding:12px 24px;border-radius:8px;font-family:'Heebo',sans-serif;font-size:14px;font-weight:600;cursor:pointer;border:none;margin-top:16px}
@media(max-width:480px){.container{padding:16px}.card{padding:18px}.party-row{grid-template-columns:110px 1fr}}
</style>
</head>
<body>
<div class="header">
  <div class="brand">BrokerSign</div>
  <div class="secure">ğŸ”’ ×—×ª×™××” ×××•×‘×˜×—×ª</div>
</div>
<div class="container">
  <div id="loading-screen" class="loading-screen"><div class="spinner"></div><p>×˜×•×¢×Ÿ ××ª ×”××¡××š ×©×œ×š...</p></div>
  <div id="error-screen" class="error-screen" style="display:none">
    <div style="font-size:64px;margin-bottom:20px">âš ï¸</div>
    <h2 style="font-size:22px;font-weight:800;margin-bottom:10px">×”××¡××š ×œ× × ××¦×</h2>
    <p style="color:var(--mid)">×”×§×™×©×•×¨ ×©×’×•×™, ×¤×’ ×ª×•×§×¤×•, ××• ×©×”××¡××š ×›×‘×¨ × ×—×ª×.</p>
  </div>
  <div id="success-screen" class="success-screen" style="display:none">
    <div class="check">âœ…</div>
    <h2>×”×—×ª×™××” ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×”!</h2>
    <p>×¢×•×ª×§ ×”××¡××š ×”×—×ª×•× × ×©×œ×— ×œ××™×™×œ ×©×œ×š ×•×œ××ª×•×•×š.</p>
    <div class="success-details">
      <strong>âœï¸ ×¤×¨×˜×™ ×”×—×ª×™××”:</strong>
      <span id="success-name"></span><br>
      <span id="success-date"></span>
    </div>
    <button class="download-btn" onclick="downloadPDF()">ğŸ“„ ×”×•×¨×“ ××¡××š PDF ×—×ª×•×</button>
  </div>
  <div id="main-content" style="display:none">
    <div id="step1" class="step active">
      <div class="card">
        <div class="contract" id="contract-content"></div>
        <div class="fee-edit-box">
          <label>âœï¸ ×“××™ ×ª×™×•×•×š ××•×¡×›××™× â€“ × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ×œ×¤× ×™ ×”×—×ª×™××”:</label>
          <input type="text" id="fee-input" oninput="updateFee()">
          <div class="fee-edit-note">×©× ×” ××ª ×”×¡×›×•× ×‘×”×¡×›××ª ×©× ×™ ×”×¦×“×“×™× ×œ×¤× ×™ ×”×—×ª×™××”</div>
        </div>
      </div>
      <button class="btn btn-primary" onclick="goToStep(2)">×§×¨××ª×™ ××ª ×”××¡××š ×•××•×›×Ÿ/×” ×œ×—×ª×•× â†</button>
    </div>
    <div id="step2" class="step">
      <div class="card">
        <h2 style="font-size:18px;font-weight:800;margin-bottom:6px">âœï¸ ×—×ª×™××” ×“×™×’×™×˜×œ×™×ª</h2>
        <div style="font-size:13px;color:var(--mid);margin-bottom:20px">×—×ª×•×/×™ ×‘×ª×™×‘×” ×œ××˜×” ×‘××¦×‘×¢</div>
        <span class="sig-label">×—×ª×™××ª×š:</span>
        <div class="sig-area" id="sig-area">
          <canvas id="sig-canvas"></canvas>
          <div class="sig-placeholder" id="sig-ph">×—×ª×•×/×™ ×›××Ÿ ×‘××¦×‘×¢</div>
        </div>
        <button class="btn btn-ghost" onclick="clearSig()" style="width:auto;padding:6px 16px;font-size:12px;margin-bottom:20px">ğŸ—‘ × ×§×”</button>
        <div class="form-group">
          <label class="form-label">×©× ××œ× ×œ××™×©×•×¨ *</label>
          <input class="form-input" id="signer-name" placeholder="×”×›× ×¡/×™ ×©××š ×”××œ×">
        </div>
        <div class="checkbox-wrap">
          <input type="checkbox" id="agree-check">
          <label for="agree-check">×× ×™ ×××©×¨/×ª ×›×™ ×§×¨××ª×™ ××ª ×”××¡××š, ×”×‘× ×ª×™ ××ª ×ª×•×›× ×• ×•××ª ×”×ª×—×™×™×‘×•×™×•×ª×™×™, ×•×—×ª×™××ª×™ ×”×“×™×’×™×˜×œ×™×ª ××—×™×™×‘×ª ××•×ª×™ ×œ×›×œ ×“×‘×¨ ×•×¢× ×™×™×Ÿ ×›×—×ª×™××” ×‘×›×ª×‘ ×××©.</label>
        </div>
        <button class="btn btn-primary" id="submit-btn" onclick="submitSignature()" disabledâ€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
